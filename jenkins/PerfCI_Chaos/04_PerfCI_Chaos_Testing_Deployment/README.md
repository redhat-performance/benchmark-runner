# Chaos Testing Against Master/Worker Nodes

This project runs chaos testing scenarios against master and worker nodes.

There are two types of chaos tests:
- **CPU-HOG**: Simulates high CPU utilization.
- **NODE-FAILURE**: Simulates node failure.

To run the chaos testing pipeline successfully, configure the required environment variables listed below.

- **Important:** Run the Jenkins agent on the bastion server.

---

## ðŸš¨ Mandatory Environment Variables

| Variable                                              | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
|-------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `BOOTSTORM_SCALE`                                     | Number of VMs to launch during a bootstorm scenario (e.g., `120`).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| `DELETE_ALL`                                          | Set to `'False'` to retain running VMs; `'True'` will delete them.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| `KRKNHUB_MASTER_0_NODE_FAILURE_ENVIRONMENT_VARIABLES` | Environment variables for master node failure using krkn-hub:<br>[https://krkn-chaos.dev/docs/scenarios/node-scenarios/](https://krkn-chaos.dev/docs/scenarios/node-scenarios/)<br>Example: `export UUID="1234"; export TIMEOUT="3600"; export DURATION="600"; export TOTAL_CHAOS_DURATION="600"; export CLOUD_TYPE="bm"; export BMC_USER="user"; export BMC_PASSWORD="password"; export BMC_ADDR="ip"; export NODE_NAME="node-0"; export ENABLE_ES="True"; export ES_SERVER="elastic_server_name"; export ES_PORT="9200"; export ES_METRICS_INDEX="krkn-hub-master-failure-test"; export ES_COLLECT_METRICS="True"`                                                                                                        |
| `KRKNHUB_MASTER_1_CPU_HOG_ENVIRONMENT_VARIABLES`      | Environment variables for master CPU hog using krkn-hub:<br>[https://krkn-chaos.dev/docs/scenarios/hog-scenarios/cpu-hog-scenario/cpu-hog-scenario-krkn-hub/](https://krkn-chaos.dev/docs/scenarios/hog-scenarios/cpu-hog-scenario/cpu-hog-scenario-krkn-hub/)<br>Example: `export UUID="1234"; export TIMEOUT="3600"; export TOTAL_CHAOS_DURATION="600"; export NODE_CPU_PERCENTAGE="90"; export NODE_SELECTOR="kubernetes.io/hostname=node-1"; export NUMBER_OF_NODES="1"; export ENABLE_ES="True"; export ES_SERVER="elastic_server_name"; export ES_PORT="9200"; export ES_METRICS_INDEX="krkn-hub-master-cpu-hog-test"; export ES_COLLECT_METRICS="True"; export TAINTS=["node-role.kubernetes.io/master:NoSchedule"]` |
| `KRKNHUB_WORKER_0_NODE_FAILURE_ENVIRONMENT_VARIABLES` | Environment variables for worker node failure using krkn-hub:<br>[https://krkn-chaos.dev/docs/scenarios/node-scenarios/](https://krkn-chaos.dev/docs/scenarios/node-scenarios/)<br>Example: `export UUID="1234"; export TIMEOUT="3600"; export DURATION="600"; export TOTAL_CHAOS_DURATION="600"; export CLOUD_TYPE="bm"; export BMC_USER="user"; export BMC_PASSWORD="password"; export BMC_ADDR="ip"; export NODE_NAME="node-0"; export ENABLE_ES="True"; export ES_SERVER="elastic_server_name"; export ES_PORT="9200"; export ES_METRICS_INDEX="krkn-hub-worker-failure-test"; export ES_COLLECT_METRICS="True"`                                                                                                        |
| `KRKNHUB_WORKER_1_CPU_HOG_ENVIRONMENT_VARIABLES`      | Environment variables for worker CPU hog using krkn-hub:<br>[https://krkn-chaos.dev/docs/scenarios/hog-scenarios/cpu-hog-scenario/cpu-hog-scenario-krkn-hub/](https://krkn-chaos.dev/docs/scenarios/hog-scenarios/cpu-hog-scenario/cpu-hog-scenario-krkn-hub/)<br>Example: `export UUID="1234"; export TIMEOUT="3600"; export TOTAL_CHAOS_DURATION="600"; export NODE_CPU_PERCENTAGE="90"; export NODE_SELECTOR="kubernetes.io/hostname=node-1"; export NUMBER_OF_NODES="1"; export ENABLE_ES="True"; export ES_SERVER="elastic_server_name"; export ES_PORT="9200"; export ES_METRICS_INDEX="krkn-hub-worker-cpu-hog-test"; export ES_COLLECT_METRICS="True"`                                                              |
| `KUBEADMIN_PASSWORD`                                  | Path to `kubeadmin-password` file on the bastion host (e.g., `/home/jenkins/.kube/kubeadmin-password`).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| `KUBECONFIG_PATH` / `PROVISION_KUBECONFIG_PATH`       | Path to `kubeconfig` file on the bastion host. Use `PROVISION_KUBECONFIG_PATH` during the provisioning phase (e.g., `/root/.kube/config`).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| `LOCAL_LOG_PATH`                                      | Local log directory on bastion server for debugging. Must set `SAVE_ARTIFACTS_LOCAL='True'` (e.g., `/tmp/benchmark-runner-run-artifacts`).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| `MUST_GATHER_LOG`                                     | Whether to collect must-gather logs for OCP and CNV/ODF operators on VM verification failure (`'True'` or `'False'`; default is `'False'`).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| `QUAY_BENCHMARK_RUNNER_REPOSITORY`                    | Benchmark-runner image from Quay.io (e.g., `quay.io/benchmark-runner/benchmark-runner:latest`).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| `RUN_STRATEGY`                                        | Set to `'True'` to apply `Always` runStrategy for NHC/SNR workloads.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| `RUN_TYPE`                                            | Run type identifier, typically `'chaos_ci'` for log stamping.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| `SAVE_ARTIFACTS_LOCAL`                                | `'True'` or `'False'` to save logs locally (default is `'False'`).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| `SCALE_NODES`                                         | List of workload nodes to scale on (e.g., `["node-0", "node-1", "node-2"]`).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| `TEST_NAME`                                           | Test name                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| `THREADS_LIMIT`                                       | Maximum number of parallel threads for VM verification. Set based on bastionâ€™s physical CPU count (e.g., `20`).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| `TIMEOUT`                                             | Timeout for operations in seconds (e.g., `7200`).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| `VERIFICATION_ONLY`                                   | If `'True'`, skips deployment and performs only verification (default is `'True'`).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| `WORKLOAD`                                            | Type of workload to run. Use `bootstorm_vm` to deploy Fedora 37 VMs.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| `WORKSPACE`                                           | Jenkins workspace path on the bastion host (e.g., `/home/jenkins`).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| `WORKSPACE_PATH`                                      | Full path to Jenkins job workspace (e.g., `${env.WORKSPACE}/workspace/${env.JOB_NAME}/`).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |

## ðŸ”§ Optional Environment Variables
| Variable                         | Description                                                                            |
|----------------------------------| -------------------------------------------------------------------------------------- |
| `CONTACT_EMAIL`                  | Jenkins job notification email (sent on job success or failure).                       |
| `ELASTICSEARCH`                  | Elasticsearch server URL.                                                              |
| `ELASTICSEARCH_PORT`             | Port number used by the Elasticsearch server.                                          |
| `GOOGLE_DRIVE_PATH`              | Base URL of the Google Drive folder (e.g., `https://drive.google.com/drive/folders/`). |
| `GOOGLE_DRIVE_CREDENTIALS_FILE`  | Content of the Google Drive service account credentials JSON file.                     |
| `GOOGLE_DRIVE_TOKEN_FILE`        | Content of the Google Drive OAuth token JSON file.                                     |
| `GOOGLE_CREDENTIALS_FILE`        | File name of the credentials JSON (e.g., `credentials.json`).                          |
| `GOOGLE_TOKEN_FILE`              | File name of the token JSON (e.g., `token.json`).                                      |
| `GOOGLE_DESTINATION_PATH`        | Local path where logs or files are temporarily stored (e.g., `/tmp`).                  |
| `GOOGLE_DRIVE_SHARED_DRIVE_ID`   | ID of the root Google Drive folder (Shared Drive) where all logs are saved.            |

---

## ðŸ“Œ Notes

- Use Jenkins credentials bindings to securely handle secret values.
- Ensure all paths and IPs are accessible from the Jenkins host.
- Always validate your environment variables before running the deployment pipeline.


---

